<!-- index.md : GitHub Pages MOS Evaluation (Audio-Visual Video Only) -->

---
layout: default
title: MOS Evaluation
---

<style>
body {
  font-family: Arial, sans-serif;
  max-width: 960px;
  margin: auto;
}
.stimulus-block {
  margin-bottom: 50px;
  padding-bottom: 30px;
  border-bottom: 1px solid #ddd;
}
.mos label {
  display: block;
  margin: 4px 0;
}
button {
  padding: 12px 30px;
  font-size: 16px;
  margin: 30px 0;
}
</style>

# Mean Opinion Score (MOS) Evaluation

Please watch each video **with audio enabled** and rate the overall perceived quality.

- Use **headphones** if possible.
- Keep the **playback volume unchanged** during the experiment.
- Each video must be played before rating.

---

<div id="stimulus"></div>

<button id="nextBtn" onclick="nextPage()">Next Page</button>

<script>
/************************************************************
 * âœ… EDIT ONLY THIS PART
 ************************************************************/

const ITEMS_PER_PAGE = 5;

const stimuli = [
  { id: "v01", file: "./samples/video/0_ts/v_00.mp4" },
  { id: "v02", file: "./samples/video/0_ts/v_01.mp4" },
  { id: "v03", file: "./samples/video/0_ts/v_02.mp4" },
  { id: "v04", file: "./samples/video/0_ts/v_03.mp4" },
  { id: "v05", file: "./samples/video/0_ts/v_04.mp4" },
  { id: "v06", file: "./samples/video/1_rms/v_00.mp4" }
  { id: "v07", file: "./samples/video/1_rms/v_01.mp4" },
  { id: "v08", file: "./samples/video/1_rms/v_02.mp4" }
  { id: "v09", file: "./samples/video/1_rms/v_03.mp4" },
  { id: "v10", file: "./samples/video/1_rms/v_04.mp4" }
];

/************************************************************
 * internal logic
 ************************************************************/

let trials;
let pageIndex = 0;
let results = [];

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

// participant-wise randomization
if (sessionStorage.getItem("trialOrder")) {
  trials = JSON.parse(sessionStorage.getItem("trialOrder"));
} else {
  trials = [...stimuli];
  shuffle(trials);
  sessionStorage.setItem("trialOrder", JSON.stringify(trials));
}

function loadPage() {
  const container = document.getElementById("stimulus");
  container.innerHTML = "";

  const start = pageIndex * ITEMS_PER_PAGE;
  const pageTrials = trials.slice(start, start + ITEMS_PER_PAGE);

  pageTrials.forEach((t, i) => {
    const div = document.createElement("div");
    div.className = "stimulus-block";

    div.innerHTML = `
      <b>Stimulus ${start + i + 1}</b><br><br>
      <video width="720" controls preload="auto">
        <source src="${t.file}" type="video/mp4">
      </video>

      <div class="mos">
        <p><b>Rate perceived quality:</b></p>
        <label><input type="radio" name="mos_${t.id}" value="5"> 5 Excellent</label>
        <label><input type="radio" name="mos_${t.id}" value="4"> 4 Good</label>
        <label><input type="radio" name="mos_${t.id}" value="3"> 3 Fair</label>
        <label><input type="radio" name="mos_${t.id}" value="2"> 2 Poor</label>
        <label><input type="radio" name="mos_${t.id}" value="1"> 1 Bad</label>
      </div>
    `;

    container.appendChild(div);
  });
}

function nextPage() {
  const start = pageIndex * ITEMS_PER_PAGE;
  const pageTrials = trials.slice(start, start + ITEMS_PER_PAGE);

  for (const t of pageTrials) {
    const sel = document.querySelector(`input[name="mos_${t.id}"]:checked`);
    if (!sel) {
      alert("Please rate all videos on this page.");
      return;
    }

    results.push({
      stimulus: t.id,
      mos: sel.value,
      page: pageIndex + 1
    });
  }

  pageIndex++;

  if (pageIndex * ITEMS_PER_PAGE < trials.length) {
    loadPage();
  } else {
    downloadResults();
  }
}

function downloadResults() {
  const header = "stimulus,mos,page\n";
  const rows = results.map(r =>
    `${r.stimulus},${r.mos},${r.page}`
  ).join("\n");

  const blob = new Blob([header + rows], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "mos_results.csv";
  a.click();

  document.body.innerHTML = "<h2>Thank you for your participation.</h2><p>Your results have been downloaded.</p>";
}

loadPage();
</script>

